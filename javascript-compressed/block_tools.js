"use strict";function isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _construct(){return _construct=isNativeReflectConstruct()?Reflect.construct:function(b,c,d){var e=[null];e.push.apply(e,c);var a=Function.bind.apply(b,e),f=new a;return d&&_setPrototypeOf(f,d.prototype),f},_construct.apply(null,arguments)}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _toConsumableArray(a){return _arrayWithoutHoles(a)||_iterableToArray(a)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(a){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a))return Array.from(a)}function _arrayWithoutHoles(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}}function _slicedToArray(a,b){return _arrayWithHoles(a)||_iterableToArrayLimit(a,b)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(a,b){if(Symbol.iterator in Object(a)||"[object Arguments]"===Object.prototype.toString.call(a)){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!(b&&c.length===b));d=!0);}catch(a){e=!0,f=a}finally{try{d||null==h["return"]||h["return"]()}finally{if(e)throw f}}return c}}function _arrayWithHoles(a){if(Array.isArray(a))return a}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _typeof(a){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}var BlockTools,__decorate=function(a,b,e,f){var g,h=arguments.length,c=3>h?b:null===f?f=Object.getOwnPropertyDescriptor(b,e):f;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(a,b,e,f);else for(var j=a.length-1;0<=j;j--)(g=a[j])&&(c=(3>h?g(c):3<h?g(b,e,c):g(b,e))||c);return 3<h&&c&&Object.defineProperty(b,e,c),c};(function(a){a.createXml=function(a){return Blockly.Xml.textToDom("<xml>"+a+"</xml>")},a.obtainXml=function(b){return Array.from(a.createXml(b).childNodes).crumble()},a.map=function(){var b=function(b,c,d){return{block:b,scope:c,diagram:d,getValue:function getValue(c){return a.getValue(b,c)}}},c=function(a,b,c){return a[b]instanceof Array?a[b][a[b].push(c)-1]:(a[b]=c,a[b])},d=function(d,f,g,h,i,j){var k=j[d];if(k instanceof Object&&"function"!=typeof k)i=c(i,d,{}),e(f,g,h,i,k);else{if("function"==typeof k&&(k=k.call(b(g,i,h))),"string"!=typeof k)throw new TypeError("Invalid return value in \""+d+"\", expected string, got "+Object.getType(k)+".");c(i,d,a.getValue(g,k))}},e=function(a,c,f,g,h){if(!c.isInsertionMarker()){h=h||a.$main,f=f||{},g=g||f,g=h.$as?g=g[h.$as]=g[h.$as]||{}:g;var i=c.getNextBlock(),j=c.getPreviousBlock(),k=h.$next,l=h.$prev;h.$runme&&h.$runme.call(b(c,g,f));var m=function(e){var i=h[e];return["$next","$prev","$as","$runme"].includes(e)?"continue":["$lit_","$literal_"].some(function(a){return e.startsWith(a)})?(i=e.startsWith("$lit_")&&"function"==typeof i?i.call(b(c,g,f)):Object.clone(i),g[e.substr(e.indexOf("_")+1)]=i,"continue"):"string"==typeof i&&i.startsWith("$")?(g[e]=c.id,"continue"):void d(e,a,c,f,g,h)};for(var o in h){var n=m(o)}return k&&i&&("function"==typeof k&&(k=k.call(b(c,g,f),i)),e(a,i,f,g,a[k])),f}};return e}();var b;(function(a){var b=function(a){function b(a,c,d){var e;if(_classCallCheck(this,b),a instanceof Error)e=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,"Encountered error while mapping.",a));else{var f=d.split("."),g=f[c];f=f.slice(0,c);var h=function(a,b){return("string"==typeof a?a.length:a)+b.length+1},i=0==f.length?0:f.reduce(h);i="string"==typeof i?i.length+1:i,e=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this,"No ".concat(a," with the name \"").concat(g,"\".\n\t\t").concat(d,"\n\t\t").concat(" ".repeat(i)).concat("~".repeat(g.length)))),e.path=d,e.index=c,e.type=a}return _possibleConstructorReturn(e)}return _inherits(b,a),b}(AdvancedError);a.MapperError=b})(b=a.Map||(a.Map={})),a.getValue=function(a,c){for(var d=function(a){return null=={false:!1,true:!0}[a.toLowerCase()]?isNaN(parseInt(a))?a:parseInt(a):{false:!1,true:!0}[a.toLowerCase()]},e=a,f=c.split("."),g=0;g<f.length;g++){e=e;var h=f[g];if(null==e.getInput(h)&&g!=f.length-1)throw new b.MapperError("input",g,c);else if(null==e.getField(h)&&g==f.length-1)throw new b.MapperError("field",g,c);if(e=g==f.length-1?e.getFieldValue(h):e.getInputTargetBlock(h),null==e)return}return d(e)};var c=function(){function b(a,c){_classCallCheck(this,b),this.generators={},this.mapper=a,this.blockType=c}return _createClass(b,[{key:"generate",value:function generate(c,d){var e=this,f=c.getAllBlocks();if("string"==typeof this.blockType)f=f.filter(function(a){return a.type==e.blockType});else{var k=f;f=this.blockType(f),f=f.filter(function(a){return k.includes(a)})}var g={time:function time(a){this[a]=this[a]?(performance.now()-this[a])/1e3:performance.now()}};g.time("mapping");var h=f.map(function(c){return[c.id,function(){try{return a.map(e.mapper,c)}catch(a){return new b.GeneratorError("Map process failed.",a)}}()]});g.time("mapping");var i={};"string"==typeof d&&(d=this.generators[d]);var j=h.map(function(a){var c=_slicedToArray(a,2),e=c[0],f=c[1];if(f instanceof b.GeneratorError)return f;var h;g.time(e);try{h=d(f,i)}catch(a){h=new b.GeneratorError("Compile process failed.",a)}return h instanceof b.GeneratorError?g[e]=null:g.time(e),h});return console.debug("Generator Timing Object (In Seconds):",g),j}},{key:"addGenerator",value:function addGenerator(a,b){this.generators[b]=a}}]),b}();a.CodeGenerator=c,function(a){var b=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(AdvancedError);a.GeneratorError=b}(c=a.CodeGenerator||(a.CodeGenerator={}));var d=function(){function a(){_classCallCheck(this,a),this.shown="",this.used="",this.problems=[]}return _createClass(a,[{key:"append",value:function append(){for(var b=arguments.length,c=Array(b),d=0;d<b;d++)c[d]=arguments[d];for(var e,f=0,g=c;f<g.length;f++)if(e=g[f],e instanceof Array)e[0]&&(this.shown+=e[0]),e[1]&&(this.used+=e[1]);else if(e instanceof a){var h;this.shown+=e.getShown(),this.used+=e.getUsed(),(h=this.problems).push.apply(h,_toConsumableArray(e.getProblems()))}else this.shown+=e,this.used+=e;return this}},{key:"ifOver",value:function ifOver(b){var c=this.shown.length-this.shown.lastIndexOf("\n")>=b,d=this.used.length-this.used.lastIndexOf("\n")>=b;c&&(this.shown+="\n"),d&&(this.used+="\n");for(var e=arguments.length,f=Array(1<e?e-1:0),g=1;g<e;g++)f[g-1]=arguments[g];for(var h,i=0,j=f;i<j.length;i++)h=j[i],h instanceof Array?(c&&h[0]&&(this.shown+=h[0]),d&&h[1]&&(this.used+=h[1])):h instanceof a?(c&&(this.shown+=h.getShown()),d&&(this.used+=h.getUsed())):(c&&(this.shown+=h),d&&(this.used+=h));return this}},{key:"pushProblem",value:function pushProblem(a){return this.problems.push(a),this}},{key:"getShown",value:function getShown(){return this.shown}},{key:"getUsed",value:function getUsed(){return this.used}},{key:"getProblems",value:function getProblems(){return this.problems}}]),a}();a.Code=d;var e=function(){var c=Math.max;function b(){_classCallCheck(this,b),this.table={},this.updateDropdown=this.divert(function(a){var b=Object.entries(this.table).map(function(b){return b.reverse()}),c=a&&"-1"!=a.getValue()?[["Delete Type...","-3"]]:[];return[["Anything","-1"]].concat(_toConsumableArray(b),[["Create Type...","-2"]],c)}),this.validateDropdown=this.divert(function(a,b){var c=this,d={"-2":function _(){return c.createType()||null},"-3":function _(){return c.deleteType(a.sourceBlock_.workspace,a.getValue())}},e=d[b]?d[b]():void 0;return e})}return _createClass(b,[{key:"divert",value:function divert(a){var b=this;return function(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return d.unshift(this),a.apply(b,d)}}},{key:"getConstructArgs",value:function getConstructArgs(){return[this.updateDropdown,this.validateDropdown]}},{key:"buildToolbox",value:function buildToolbox(){var b=function(b,c){return a.obtainXml("<button text=\""+b+"\" callbackKey=\""+c+"\"/>")},c="<block type=\"builder_type\"><field name=\"type\">",d="</field></block>",e=[b("Create Type...","createType")];for(var f in 0!=Object.keys(this.table).length&&e.push(b("Delete Type...","deleteType")),e.push(a.obtainXml([c,"-1",d].join(""))),this.table)e.push(a.obtainXml([c,f,d].join("")));return e}},{key:"createType",value:function createType(a){var b=prompt("Enter the name of the type to create...");if(![null,""].includes(b)){if(Object.values(this.table).includes(b))return alert("A type already exists with the name \""+b+"\".");var d=c.apply(Math,[-1].concat(_toConsumableArray(Object.keys(this.table).map(function(a){return parseInt(a)}))))+1;return this.table[d]=b,a&&a.getTargetWorkspace().getToolbox().refreshSelection(),d.toString()}}},{key:"deleteType",value:function deleteType(a,b,d){if(a instanceof Blockly.Workspace){if(!Object.keys(this.table).includes(b))return!1;if(!d&&(d=confirm("Are you sure you want to delete the type \""+this.table[b]+"\"?"),!d))return!1;var e=Object.entries(this.table).find(function(a){var c=_slicedToArray(a,1),d=c[0];return d==b}),f=_slicedToArray(e,1),g=f[0];delete this.table[g];var h=!0,i=!1,j=void 0;try{for(var k,l,m=a.getAllBlocks()[Symbol.iterator]();!(h=(k=m.next()).done);h=!0)l=k.value,"builder_type"==l.type&&l.getField("type").getValue()==g&&l.dispose(!1,!0)}catch(a){i=!0,j=a}finally{try{h||null==m["return"]||m["return"]()}finally{if(i)throw j}}return!0}var n=this.table[c.apply(Math,_toConsumableArray(Object.keys(this.table).map(function(b){return parseInt(b)})))];return(b=prompt("Enter the name of the type to delete...",n),![null,""].includes(b))&&((b=Object.fromEntries(Object.entries(this.table).map(function(b){return b.reverse()}))[b],this.deleteType(a.getTargetWorkspace(),b,!0))?(a.getTargetWorkspace().getToolbox().refreshSelection(),!0):(alert("No type exists with the name \""+b+"\"."),!1))}},{key:"register",value:function register(a){a.registerToolboxCategoryCallback("TYPES",this.buildToolbox),a.registerButtonCallback("createType",this.createType),a.registerButtonCallback("deleteType",this.deleteType)}},{key:"toType",value:function toType(a){return"-1"==a?null:this.table[a]}}]),b}();__decorate([bound],e.prototype,"buildToolbox",null),__decorate([bound],e.prototype,"createType",null),__decorate([bound],e.prototype,"deleteType",null),a.Types=e;var f=function(){function a(b){_classCallCheck(this,a),this.colour=null,this.inputStyle=null,this.hat=void 0,this.inputs=[],this.output=void 0,this.previous=void 0,this.next=void 0,this.name=b}return _createClass(a,[{key:"appendValueInput",value:function appendValueInput(b){return this.inputs.push(new a.ValueInput(b)),this}},{key:"appendStatementInput",value:function appendStatementInput(b){return this.inputs.push(new a.StatementInput(b)),this}},{key:"appendDummyInput",value:function appendDummyInput(){return this.inputs.push(new a.DummyInput),this}},{key:"getLastInput",value:function getLastInput(){return 0==this.inputs.length&&this.appendDummyInput(),this.inputs.last}},{key:"appendField",value:function appendField(a,b){return this.getLastInput().appendField(a,b),this}},{key:"setAlign",value:function setAlign(a){return this.getLastInput().setAlign(a),this}},{key:"setCheck",value:function setCheck(){var b=this.getLastInput();if(!(b instanceof a.TypedInput))throw new TypeError("The last input provided is not a TypedInput.");for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return b.setCheck(d),this}},{key:"setOutput",value:function setOutput(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return"boolean"!=typeof b[0]||b.shift()?(this.output=b.crumbleFlat(),this):this}},{key:"setPreviousStatement",value:function setPreviousStatement(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return"boolean"!=typeof b[0]||b.shift()?(this.previous=b.crumbleFlat(),this):this}},{key:"setNextStatement",value:function setNextStatement(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return"boolean"!=typeof b[0]||b.shift()?(this.next=b.crumbleFlat(),this):this}},{key:"setBothStatements",value:function setBothStatements(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];return"boolean"!=typeof b[0]||b.shift()?(this.next=b.crumbleFlat(),this.previous=this.next,this):this}},{key:"setHat",value:function setHat(a){return this.hat=a?"cap":void 0,this}},{key:"setInputsInline",value:function setInputsInline(a){return this.inputStyle=a,this}},{key:"setColour",value:function setColour(a){return this.colour=a,this}},{key:"build",value:function build(){var b=this,c=function(){var c=!0,d=!1,e=void 0;try{for(var f,g=b.inputs[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h,i=f.value,j=(h={},_defineProperty(h,a.DummyInput.name,"DummyInput"),_defineProperty(h,a.StatementInput.name,"StatementInput"),_defineProperty(h,a.ValueInput.name,"ValueInput"),h)[i.constructor.name],k=i instanceof a.TypedInput?i:null,l=this["append"+j](k&&k.name);l.setAlign(i.alignment),k&&l.setCheck(k.acceptingType);var m=!0,n=!1,o=void 0;try{for(var p,q=i.fields[Symbol.iterator]();!(m=(p=q.next()).done);m=!0){var r,s=p.value;if("string"==typeof s){l.appendField(s);continue}var t=(r={},_defineProperty(r,a.FieldAngle.name,"FieldAngle"),_defineProperty(r,a.FieldDropdown.name,"FieldDropdown"),_defineProperty(r,a.FieldTextInput.name,"FieldTextInput"),r)[s.constructor.name];l.appendField(_construct(Blockly[t],_toConsumableArray(s.getArguments())),s.name)}}catch(a){n=!0,o=a}finally{try{m||null==q["return"]||q["return"]()}finally{if(n)throw o}}}}catch(a){d=!0,e=a}finally{try{c||null==g["return"]||g["return"]()}finally{if(d)throw e}}this.setOutput(void 0!==b.output,b.output),this.setPreviousStatement(void 0!==b.previous,b.previous),this.setNextStatement(void 0!==b.next,b.next),this.setInputsInline(b.inputStyle),this.setColour(b.colour),this.hat=b.hat};return{init:c}}},{key:"register",value:function register(){Blockly.Blocks[this.name]=this.build()}}]),a}();a.Builder=f,function(a){var b=function(){function a(){_classCallCheck(this,a),this.fields=[],this.alignment=-1}return _createClass(a,[{key:"appendField",value:function appendField(a,b){return"string"==typeof a?this.fields.push(a):void(a.name=b,this.fields.push(a))}},{key:"setAlign",value:function setAlign(a){var b={LEFT:-1,CENTRE:0,RIGHT:1};this.alignment=null==b[a]?a:b[a]}}]),a}();a.Input=b;var c=function(a){function b(a){var c;return _classCallCheck(this,b),c=_possibleConstructorReturn(this,_getPrototypeOf(b).call(this)),c.name=a,c}return _inherits(b,a),_createClass(b,[{key:"setCheck",value:function setCheck(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];this.acceptingType=b.crumbleFlat()}}]),b}(a.Input);a.TypedInput=c;var d=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(a.TypedInput);a.ValueInput=d;var e=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(a.TypedInput);a.StatementInput=e;var f=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(a.Input);a.DummyInput=f;var g=function(){function a(b,c){_classCallCheck(this,a),this.value=b,this.validator=c}return _createClass(a,[{key:"getArguments",value:function getArguments(){return[this.value,this.validator]}}]),a}();a.Field=g;var h=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(a.Field);a.FieldAngle=h;var i=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,_getPrototypeOf(b).apply(this,arguments))}return _inherits(b,a),b}(a.Field);a.FieldTextInput=i;var j=function(a){function b(a,c){if(_classCallCheck(this,b),!(a instanceof Array)&&"function"!=typeof a)a=Object.entries(a).map(function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1];return[d,c]});else if("function"==typeof a){var d=a;a=function(){for(var a=arguments.length,b=Array(a),c=0;c<a;c++)b[c]=arguments[c];var e=d.apply(this,b);return e instanceof Array?e:Object.entries(e).map(function(a){var b=_slicedToArray(a,2),c=b[0],d=b[1];return[d,c]})}}return _possibleConstructorReturn(this,_getPrototypeOf(b).call(this,a,c))}return _inherits(b,a),_createClass(b,[{key:"getArguments",value:function getArguments(){return[this.value,this.validator]}}]),b}(a.Field);a.FieldDropdown=j}(f=a.Builder||(a.Builder={}))})(BlockTools||(BlockTools={}));